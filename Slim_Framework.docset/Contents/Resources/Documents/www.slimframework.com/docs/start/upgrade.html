<!DOCTYPE html>
<html lang="en"><!-- Mirrored from www.slimframework.com/docs/start/upgrade.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 21 Sep 2016 20:42:42 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
        <title>Upgrade Guide - Slim Framework</title>
        <meta content="" name="description"/>
        <meta content="index, follow" name="robots"/>
        <meta content="Upgrade Guide" property="og:title"/>
        <meta content="Slim Framework" property="og:site_name"/>
        <meta content="upgrade.html" property="og:url"/>
        <meta content="" property="og:description"/>
        <meta content="website" property="og:type"/>
        <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <link href="../../assets/css/all.css" rel="stylesheet"/>
        <link href="../../assets/images/favicon.png" rel="shortcut icon"/>
        <link href="../../../maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"/>
        
        
        
    </head>
    <body style="padding-top: 5em">
        

<div class="wrapper docs">
    <div class="container-fluid">
        

        <div class="row">
            

            <div class="col-md-8 docs-content">
                <h1 class="page-header"><a class="dashAnchor" name="//apple_ref/cpp/Section/Upgrade%20Guide"></a>Upgrade Guide</h1>
                <div class="edit-panel" style="margin: 0 0 1em 0;">
                    <a class="btn btn-default btn-xs" href="https://github.com/slimphp/Slim-Website/tree/gh-pages/docs/start/upgrade.md" target="_blank"><i class="fa fa-github"></i> Edit This Page</a>
                </div>
                <p>If you are upgrading from version 2 to version 3, these are the significant changes that
you need to be aware of.</p>

<h2 id="new-php-version"><a class="dashAnchor" name="//apple_ref/cpp/Section/New%20PHP%20version"></a>New PHP version</h2>
<p>Slim 3 requires PHP 5.5+</p>

<h2 id="new-route-function-signature"><a class="dashAnchor" name="//apple_ref/cpp/Section/New%20Route%20Function%20Signature"></a>New Route Function Signature</h2>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$app-&gt;get('/', function (Request $req,  Response $res, $args = []) {
    return $res-&gt;withStatus(400)-&gt;write('Bad Request');
});</code></pre></figure>

<h2 id="getting-get-and-post-variables"><a class="dashAnchor" name="//apple_ref/cpp/Section/Getting%20_GET%20and%20_POST%20variables"></a>Getting _GET and _POST variables</h2>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$app-&gt;get('/', function (Request $req,  Response $res, $args = []) {
    $myvar1 = $req-&gt;getParam('myvar'); //checks both _GET and _POST [NOT PSR-7 Compliant]
    $myvar2 = $req-&gt;getParsedBody()['myvar']; //checks _POST  [IS PSR-7 compliant]
    $myvar3 = $req-&gt;getQueryParams()['myvar']; //checks _GET [IS PSR-7 compliant]
});</code></pre></figure>

<h2 id="hooks"><a class="dashAnchor" name="//apple_ref/cpp/Section/Hooks"></a>Hooks</h2>
<p>Hooks are no longer part of Slim as of v3.  You should consider reimplementing any functionality associated with the <a href="http://docs.slimframework.com/hooks/defaults/">default hooks in Slim v2</a> as <a href="../concepts/middleware.html">middleware</a> instead.  If you need the ability to apply custom hooks at arbitrary points in your code (for example, within a route), you should consider a third-party package such as <a href="http://symfony.com/doc/current/components/event_dispatcher/introduction.html">Symfony’s EventDispatcher</a> or <a href="https://zend-eventmanager.readthedocs.org/en/latest/">Zend Framework’s EventManager</a>.</p>

<h2 id="removal-http-cache"><a class="dashAnchor" name="//apple_ref/cpp/Section/Removal%20HTTP%20Cache"></a>Removal HTTP Cache</h2>
<p>In Slim v3 we have removed the HTTP-Caching into its own module <a href="https://github.com/slimphp/Slim-HttpCache">Slim\Http\Cache</a>.</p>

<h2 id="removal-of-stophalt"><a class="dashAnchor" name="//apple_ref/cpp/Section/Removal%20of%20Stop%2FHalt"></a>Removal of Stop/Halt</h2>
<p>Slim Core has removed Stop/Halt.
In your applications, you should transition to using the withStatus() and withBody() methods.</p>

<h2 id="changed-redirect"><a class="dashAnchor" name="//apple_ref/cpp/Section/Changed%20Redirect"></a>Changed Redirect</h2>
<p>In Slim v2.x one would use the helper function $app-&gt;redirect(); to trigger a redirect request.
In Slim v3.x one can do the same with using the Response class like so.</p>

<p>Example:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$app-&gt;get('/', function ($req, $res, $args) {
  return $res-&gt;withStatus(302)-&gt;withHeader('Location', 'your-new-uri');
});</code></pre></figure>

<h2 id="middleware-signature"><a class="dashAnchor" name="//apple_ref/cpp/Section/Middleware%20Signature"></a>Middleware Signature</h2>
<p>The middleware signature has changed from a class to a function.</p>

<p>New signature:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">use Psr\Http\Message\RequestInterface as Request;
use Psr\Http\Message\ResponseInterface as Response;

$app-&gt;add(function (Request $req,  Response $res, callable $next) {
    // Do stuff before passing along
    $newResponse = $next($req, $res);
    // Do stuff after route is rendered
    return $newResponse; // continue
});</code></pre></figure>

<p>You can still use a class:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">namespace My;

use Psr\Http\Message\RequestInterface as Request;
use Psr\Http\Message\ResponseInterface as Response;

class Middleware
{
    function __invoke(Request $req,  Response $res, callable $next) {
        // Do stuff before passing along
        $newResponse = $next($req, $res);
        // Do stuff after route is rendered
        return $newResponse; // continue
    }
}


// Register
$app-&gt;add(new My\Middleware());
// or
$app-&gt;add(My\Middleware::class);</code></pre></figure>

<h2 id="middleware-execution"><a class="dashAnchor" name="//apple_ref/cpp/Section/Middleware%20Execution"></a>Middleware Execution</h2>
<p>Application middleware is executed as Last In First Executed (LIFE).</p>

<h2 id="flash-messages"><a class="dashAnchor" name="//apple_ref/cpp/Section/Flash%20Messages"></a>Flash Messages</h2>
<p>Flash messages are no longer a part of the Slim v3 core but instead have been moved to seperate <a href="../features/flash.html">Slim Flash</a> package.</p>

<h2 id="cookies"><a class="dashAnchor" name="//apple_ref/cpp/Section/Cookies"></a>Cookies</h2>
<p>In v3.0 cookies has been removed from core. See <a href="https://github.com/dflydev/dflydev-fig-cookies">FIG Cookies</a> for a PSR-7 compatible cookie component.</p>

<h2 id="removal-of-crypto"><a class="dashAnchor" name="//apple_ref/cpp/Section/Removal%20of%20Crypto"></a>Removal of Crypto</h2>
<p>In v3.0 we have removed the dependency for crypto in core.</p>

<h2 id="new-router"><a class="dashAnchor" name="//apple_ref/cpp/Section/New%20Router"></a>New Router</h2>
<p>Slim now utilizes <a href="https://github.com/nikic/FastRoute">FastRoute</a>, a new, more powerful router!</p>

<p>This means that the specification of route patterns has changed with named parameters now in braces and square brackets used for optional segments:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">// named parameter:
$app-&gt;get('/hello/{name}', /*...*/);

// optional segment:
$app-&gt;get('/news[/{year}]', /*...*/);</code></pre></figure>

<h2 id="route-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/Route%20Middleware"></a>Route Middleware</h2>
<p>The syntax for adding route middleware has changed slightly.
In v3.0:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$app-&gt;get(…)-&gt;add($mw2)-&gt;add($mw1);</code></pre></figure>

<h2 id="getting-the-current-route"><a class="dashAnchor" name="//apple_ref/cpp/Section/Getting%20the%20current%20route"></a>Getting the current route</h2>
<p>The route is an attribute of the Request object in v3.0:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$request-&gt;getAttribute('route');</code></pre></figure>

<p>When getting the current route in middleware, the value for
<code class="highlighter-rouge">determineRouteBeforeAppMiddleware</code> must be set to <code class="highlighter-rouge">true</code> in the Application
configuration, otherwise the getAttribute call returns <code class="highlighter-rouge">null</code>.</p>

<h2 id="urlfor-is-now-pathfor-in-the-router"><a class="dashAnchor" name="//apple_ref/cpp/Section/urlFor%28%29%20is%20now%20pathFor%28%29%20in%20the%20router"></a>urlFor() is now pathFor() in the router</h2>

<p><code class="highlighter-rouge">urlFor()</code> has been renamed <code class="highlighter-rouge">pathFor()</code> and can be found in the <code class="highlighter-rouge">router</code> object:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$app-&gt;get('/', function ($request, $response, $args) {
    $url = $this-&gt;router-&gt;pathFor('home');
    $response-&gt;write("<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'$url'</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span>");
    return $response;
})-&gt;setName('home');</code></pre></figure>

<p>Also, <code class="highlighter-rouge">pathFor()</code> is base path aware.</p>

<h2 id="container-and-di--constructing"><a class="dashAnchor" name="//apple_ref/cpp/Section/Container%20and%20DI%20%E2%80%A6%20Constructing"></a>Container and DI … Constructing</h2>
<p>Slim uses Pimple as a Dependency Injection Container.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">// index.php
$app = new Slim\App(
    new \Slim\Container(
        include '../config/container.config.php'
    )
);

// Slim will grab the Home class from the container defined below and execute its index method.
// If the class is not defined in the container Slim will still contruct it and pass the container as the first arugment to the constructor!
$app-&gt;get('/', Home::class . ':index');


// In container.config.php
// We are using the SlimTwig here
return [
    'settings' =&gt; [
        'viewTemplatesDirectory' =&gt; '../templates',
    ],
    'twig' =&gt; [
        'title' =&gt; '',
        'description' =&gt; '',
        'author' =&gt; ''
    ],
    'view' =&gt; function ($c) {
        $view = new Twig(
            $c['settings']['viewTemplatesDirectory'],
            [
                'cache' =&gt; false // '../cache'
            ]
        );

        // Instantiate and add Slim specific extension
        $view-&gt;addExtension(
            new TwigExtension(
                $c['router'],
                $c['request']-&gt;getUri()
            )
        );

        foreach ($c['twig'] as $name =&gt; $value) {
            $view-&gt;getEnvironment()-&gt;addGlobal($name, $value);
        }

        return $view;
    },
    Home::class =&gt; function ($c) {
        return new Home($c['view']);
    }
];</code></pre></figure>

<h2 id="psr-7-objects"><a class="dashAnchor" name="//apple_ref/cpp/Section/PSR-7%20Objects"></a>PSR-7 Objects</h2>

<h3 id="request-response-uri--uploadfile-are-immutable"><a class="dashAnchor" name="//apple_ref/cpp/Section/Request%2C%20Response%2C%20Uri%20%26%20UploadFile%20are%20immutable."></a>Request, Response, Uri &amp; UploadFile are immutable.</h3>
<p>This means that when you change one of these objects, the old instance is not updated.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">// This is WRONG. The change will not pass through.
$app-&gt;add(function (Request $request, Response $response, $next) {
    $request-&gt;withAttribute('abc', 'def');
    return $next($request, $response);
});

// This is correct.
$app-&gt;add(function (Request $request, Response $response, $next) {
    $request = $request-&gt;withAttribute('abc', 'def');
    return $next($request, $response);
});</code></pre></figure>

<h3 id="message-bodies-are-streams"><a class="dashAnchor" name="//apple_ref/cpp/Section/Message%20bodies%20are%20streams"></a>Message bodies are streams</h3>

<figure class="highlight"><pre><code class="language-php" data-lang="php">// ...
$image = __DIR__ . '/huge_photo.jpg';
$body = new Stream($image);
$response = (new Response())
     -&gt;withStatus(200, 'OK')
     -&gt;withHeader('Content-Type', 'image/jpeg')
     -&gt;withHeader('Content-Length', filesize($image))
     -&gt;withBody($body);
// ...</code></pre></figure>

<p>For text:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">// ...
$response = (new Response())-&gt;getBody()-&gt;write('Hello world!')

// Or Slim specific: Not PSR-7 compliant.
$response = (new Response())-&gt;write('Hello world!');
// ...</code></pre></figure>



                <nav>
                    <ul class="nav pager">
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                
                                    
                                        <li class="previous">
                                            <a href="installation.html" rel="prev"><i class="fa fa-arrow-left"></i> <small>Get Started: </small> Installation</a>
                                        </li>
                                    
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                
                                    <li class="next">
                                        <a href="web-servers.html" rel="next"><small>Get Started: </small> Web Servers <i class="fa fa-arrow-right"></i></a>
                                    </li>
                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                    </ul>
                </nav>
            </div>
        </div>

        <footer class="site-footer">
            <p>
                Created and maintained by <br/>
                <a href="http://joshlockhart.com/">Josh Lockhart</a>,
                <a href="http://www.silentworks.co.uk/" target="_blank">Andrew Smith</a>,
                <a href="http://akrabat.com/" target="_blank">Rob Allen</a>, and the
                <a href="https://github.com/orgs/slimphp/people" target="_blank">Slim Framework Team</a>
            </p>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post" style="margin: 0; padding-top: 20px" target="_blank">
                <input name="cmd" type="hidden" value="_s-xclick"/>
                <input name="hosted_button_id" type="hidden" value="9YRVXHRZT6H3L"/>
                <input alt="PayPal - The safer, easier way to pay online!" border="0" name="submit" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" type="image"/>
                <img alt="" border="0" height="1" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1"/>
            </form>
        </footer>
    </div>
</div>
        
        
        
        
        
        
    




</body><!-- Mirrored from www.slimframework.com/docs/start/upgrade.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 21 Sep 2016 20:42:42 GMT --></html>